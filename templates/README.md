# Templates

This directory contains template files for generating language configurations and TextMate grammar files. These templates are processed by Python scripts in the [scripts/](../scripts/) directory to produce the final language support files.

## Template Files

### Language Configuration Templates

Language configuration files define editor behavior for each language:

#### `sbml-configuration.template.json`
- **Language**: SBML (Smart Book Markup Language)
- **Line Comment**: `=comment`
- **Brackets**: None
- **Auto-closing Pairs**: `"` and `'`
- **Folding**: `=begin`/`=end` and `=if`/`=end` blocks
- **Placeholder**: `__WORD_PATTERN__` - Replaced with regex for word matching

#### `sbss-configuration.template.json`
- **Language**: SBSS (Smart Book Style Sheet)
- **Line Comment**: `--`
- **Brackets**: `{` `}`
- **Folding**: `if`/`end` blocks
- **Indentation**: Auto-indent for `if`/`elif`/`else` blocks
- **Placeholder**: `__WORD_PATTERN__` - Replaced with regex for word matching

#### `bon-configuration.template.json`
- **Language**: BON (Bookjam Object Notation)
- **Brackets**: `{` `}`, `[` `]`
- **Auto-closing Pairs**: `{` `}`, `[` `]`, `(` `)`, `"`
- **Indentation**: JSON-style brace and bracket indentation
- **No Placeholders**: Generated as-is

### TextMate Grammar Templates

Grammar files define syntax highlighting rules using TextMate scope names:

#### `sbml.tmLanguage.template.json`
Defines syntax patterns for SBML language:
- **Placeholders**:
  - `__PROP_LIST_PATTERNS__` - Block property pairs
  - `__INLINE_PROP_LIST_PATTERNS__` - Inline property pairs
  - `__EXPRESSION_PATTERNS__` - Variable and operator patterns
  - `__STYLE_*__` - TextMate scope names for syntax elements

**Patterns**:
- Comments (`=comment`)
- Imports (`=import`)
- Sections (`=begin`/`=end`)
- Objects (`=object`, `=image`)
- Inline objects (`=(object type, ...)=`)
- Styles (`=style`, `=[style|content]=`)
- Anchors (`=(anchor|name)=`)
- Conditionals (`=if`/`=elif`/`=else`)

#### `sbss.tmLanguage.template.json`
Defines syntax patterns for SBSS language:
- **Placeholders**:
  - `__PROP_LIST_PATTERNS__` - Property pairs with `=` separator
  - `__PROP_GROUP_PATTERNS__` - Property pairs with `:` separator
  - `__EXPRESSION_PATTERNS__` - Variable and operator patterns
  - `__STYLE_*__` - TextMate scope names for syntax elements

**Patterns**:
- Comments (`--`)
- Imports (`import "file"`)
- Conditionals (`if`/`elif`/`else`/`end`)
- Variables (`$VARIABLE_NAME`)
- Selectors (`@root`, `#id`, `%class`, `/path`)
- Properties (inline and block styles)

#### `bon.tmLanguage.template.json`
Defines syntax patterns for BON language:
- **No Placeholders**: Standard TextMate scopes only

**Patterns**:
- Objects (`{ key: value }`)
- Arrays (`[ value1, value2 ]`)
- Strings (quoted and naked)
- Booleans (`true`, `false`, `yes`, `no`)
- Escape sequences

## Placeholders

### `__WORD_PATTERN__` (Language Configurations)

Generated by [generate-language.py](../scripts/generate-language.py):

```regex
([\w-]+(@(verso|recto))?|\$[A-Z_][A-Z0-9_]*)
```

Matches:
- Property names with optional modifiers: `background-color`, `width@verso`
- Variables: `$PRIMARY_COLOR`

### `__PROP_LIST_PATTERNS__` (Syntax Grammars)

Generated by [generate-syntax.py](../scripts/generate-syntax.py):

```json
{
    "match": "([a-z-]+(@[a-z-]+)?)\s*=\s*((\"[^\\\"]*\")|('[^\\']*')|(\$[A-Z_][A-Z0-9_]*)|([^,]*))",
    "captures": {
        "1": { "name": "entity.other.attribute-name" },
        "3": { "name": "string" },
        "6": { "name": "string markup.italic" }
    }
}
```

Matches property pairs with `=` separator and `,` terminator (used in inline and block property lists).

### `__PROP_GROUP_PATTERNS__` (Syntax Grammars)

Generated by [generate-syntax.py](../scripts/generate-syntax.py):

```json
{
    "match": "([a-z-]+(@[a-z-]+)?)\s*:\s*((\"[^\\\"]*\")|('[^\\']*')|(\$[A-Z_][A-Z0-9_]*)|([^;]*))",
    "captures": {
        "1": { "name": "entity.other.attribute-name" },
        "3": { "name": "string" },
        "6": { "name": "string markup.italic" }
    }
}
```

Matches property pairs with `:` separator and `;` terminator (used in SBSS style blocks).

### `__INLINE_PROP_LIST_PATTERNS__` (Syntax Grammars)

Similar to `__PROP_LIST_PATTERNS__` but specifically for inline contexts like `=(object type, prop=value)=`.

### `__EXPRESSION_PATTERNS__` (Syntax Grammars)

Generated by [generate-syntax.py](../scripts/generate-syntax.py):

```json
{
    "name": "string markup.italic",
    "match": "\$[A-Z_][A-Z0-9_]*"
},
{
    "name": "keyword.operator",
    "match": "(==|!=|\*|\+|-|/|<|<=|>|>=)"
},
{
    "name": "constant.numeric",
    "match": "[+-]?([0-9]*[.])?[0-9]+(pw|ph|cw|ch|mt|mr|mb|ml|sbh|eb|%)?"
}
```

Matches:
- Variables: `$VARIABLE_NAME`
- Operators: `==`, `!=`, `+`, `-`, `*`, `/`, `<`, `<=`, `>`, `>=`
- Lengths: Numbers with optional units (`100pw`, `50%`, `16`)

### `__STYLE_*__` Placeholders (Syntax Grammars)

Style placeholders are replaced with TextMate scope names:

| Placeholder | Scope Name | Description |
|------------|-----------|-------------|
| `__STYLE_COMMENT__` | `comment.line` | Comments |
| `__STYLE_SBSS_IMPORT__` | `keyword.other` | SBSS import keyword |
| `__STYLE_SBSS_IF_ELIF__` | `keyword.control` | SBSS if/elif keywords |
| `__STYLE_SBSS_ELSE_END__` | `keyword.control` | SBSS else/end keywords |
| `__STYLE_SBSS_SELECTOR__` | `entity.name.tag` | SBSS selectors |
| `__STYLE_SBML_IMPORT__` | `keyword.other` | SBML =import |
| `__STYLE_SBML_BEGIN__` | `keyword.other` | SBML =begin |
| `__STYLE_SBML_END__` | `keyword.other` | SBML =end |
| `__STYLE_SBML_SECTION_NAME__` | `entity.name.type markup.italic` | Section names |
| `__STYLE_SBML_IF_ELIF__` | `keyword.other` | SBML =if/=elif |
| `__STYLE_SBML_ELSE__` | `keyword.other` | SBML =else |
| `__STYLE_SBML_BLOCK_OBJECT__` | `keyword.control` | SBML =object/=image |
| `__STYLE_SBML_STYLE__` | `keyword.control` | SBML =style |
| `__STYLE_SBML_INLINE_OBJECT__` | `keyword.other` | Inline object markers |
| `__STYLE_SBML_OBJECT_TYPE__` | `entity.name.type` | Object type names |
| `__STYLE_SBML_STYLE_MARK__` | `keyword.other` | Style markers `=[` `]=` |
| `__STYLE_SBML_STYLE_NAME__` | `entity.name.type` | Style names |
| `__STYLE_SBML_ANCHOR_MARK__` | `keyword.other` | Anchor markers |
| `__STYLE_SBML_ANCHOR_NAME__` | `string` | Anchor names |
| `__STYLE_PROP_NAME__` | `entity.other.attribute-name` | Property names |
| `__STYLE_PROP_VALUE__` | `string` | Property values |
| `__STYLE_PROP_SEP__` | `keyword.operator` | Property separators |
| `__STYLE_INVALID__` | `invalid.illegal` | Invalid syntax |
| `__STYLE_VARIABLE__` | `string markup.italic` | Variables |
| `__STYLE_FILENAME__` | `string` | File names |
| `__STYLE_LENGTH__` | `constant.numeric` | Numeric lengths |
| `__STYLE_OPERATOR__` | `keyword.operator` | Operators |

## Generation Process

1. **Edit Templates**: Modify template files in this directory
2. **Run Generator**: Execute `make` from project root
3. **Generated Files**:
   - Language configurations → `languages/*.json`
   - Syntax grammars → `syntaxes/*.tmLanguage.json`

See [scripts/README.md](../scripts/README.md) for detailed generation documentation.

## Editing Guidelines

### Language Configuration Templates

- Define editor behavior (comments, brackets, folding, indentation)
- Use `__WORD_PATTERN__` placeholder for word matching regex
- Test folding and indentation rules with real code samples

### TextMate Grammar Templates

- Use placeholders for generated patterns (`__PROP_*_PATTERNS__`, `__EXPRESSION_PATTERNS__`)
- Use style placeholders (`__STYLE_*__`) for consistent scope naming
- Follow TextMate grammar conventions
- Test with various code samples to ensure proper syntax highlighting

### Testing Changes

1. Edit template file
2. Run `make` to regenerate files
3. Run extension in debug mode (`Run > Run Without Debugging`)
4. Test with sample `.sbss`, `.sbml`, or `.bon` files
5. Verify syntax highlighting, folding, and indentation behavior

## References

- [VS Code Language Configuration](https://code.visualstudio.com/api/language-extensions/language-configuration-guide)
- [TextMate Language Grammars](https://macromates.com/manual/en/language_grammars)
- [TextMate Scope Naming](https://www.sublimetext.com/docs/scope_naming.html)
- [VS Code Syntax Highlighting Guide](https://code.visualstudio.com/api/language-extensions/syntax-highlight-guide)
